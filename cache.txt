 import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;
import javax.servlet.http.HttpServletRequest;

public class CorrelationIdExtractor {
    public static String extractCorrelationId() {
        RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();
        if (requestAttributes instanceof ServletRequestAttributes) {
            HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
            String correlationId = request.getHeader("X-Correlation-ID");
            if (correlationId != null) {
                return correlationId;
            }
        }
        return "";
    }
}

......
<dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>javax.servlet-api</artifactId>
        <version>4.0.1</version>
        <scope>provided</scope>
    </dependency>
.........
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;
import javax.servlet.http.HttpServletRequest;

public class CorrelationIdExtractor {
    public static String extractCorrelationId() {
        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        String correlationId = request.getHeader("X-Correlation-ID");
        return correlationId != null ? correlationId : "";
    }
}




import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class MyController {
    @GetMapping("/my-endpoint")
    public String myEndpoint() {
        String correlationId = CorrelationIdExtractor.extractCorrelationId();

        // Use the extracted correlationId as needed
        // ...
        
        return "Response";
    }
}

.................................................................
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class YourController {

    @GetMapping("/your-endpoint")
    public String yourEndpointMethod(@RequestHeader("Correlation-ID") String correlationId) {
        // Use the correlationId value for further processing
        // ...
        return "Correlation ID: " + correlationId;
    }
}
,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,



@Configuration
@EnableCaching
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager();
        cacheManager.setCaffeine(caffeineCacheBuilder());
        return cacheManager;
    }

    @Bean
    public Caffeine<Object, Object> caffeineCacheBuilder() {
        return Caffeine.newBuilder()
                .expireAfterWrite(1, TimeUnit.MINUTES) // Set the expiration time for the tokens
                .maximumSize(100); // Set the maximum number of tokens to store in the cache
    }
}







@Component
public class TokenCache {
	private static final String TOKEN_CACHE_NAME = "tokens";

	@Autowired
	private CacheManager cacheManager;

	@Cacheable(value = TOKEN_CACHE_NAME)
	public String getToken() {
		// Retrieve the token from the cache or data source
		Cache cache = cacheManager.getCache(TOKEN_CACHE_NAME);
		if (cache != null) {
			Cache.ValueWrapper valueWrapper = cache.get(TOKEN_CACHE_NAME);
			if (valueWrapper != null) {
				return (String) valueWrapper.get();
			}
		}

		String tokenFromDataSource = retrieveTokenFromDataSource();
		cacheToken(tokenFromDataSource); // Cache the token for future use
		return tokenFromDataSource;
	}

	private String retrieveTokenFromDataSource() {
		// Perform the actual retrieval of the token from the data source
		// This can involve querying a database, making an API call, or any other
		// necessary logic
		// Return the retrieved token
		return "token-from-data-source";
	}

	private void cacheToken(String token) {
		Cache cache = cacheManager.getCache(TOKEN_CACHE_NAME);
		if (cache != null) {
			cache.put(TOKEN_CACHE_NAME, token);
		}
	}
}






import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cache.annotation.EnableCaching;

@SpringBootApplication
@EnableCaching

public class Demo1Application {

	public static void main(String[] args) {
		SpringApplication.run(Demo1Application.class, args);

	}

}









@Autowired
private TokenCache tokenCache;

public void retrieveTokenFromCache() {
    String token = tokenCache.getToken();
    System.out.println("Token from cache: " + token);
}




////////////////////////////////////////////////////////////////////////







		<dependency>
			<groupId>com.google.guava</groupId>
			<artifactId>guava</artifactId>
			<version>30.1-jre</version>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-cache</artifactId>
		</dependency>
		<dependency>
			<groupId>com.github.ben-manes.caffeine</groupId>
			<artifactId>caffeine</artifactId>
			<version>3.0.4</version>
		</dependency>




package com.example.demo;
import com.github.benmanes.caffeine.cache.Caffeine;

import java.util.concurrent.TimeUnit;

import org.springframework.cache.CacheManager;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.cache.caffeine.CaffeineCacheManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
@EnableCaching
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager();
        cacheManager.setCaffeine(caffeineCacheBuilder());
        return cacheManager;
    }

    @Bean
    public Caffeine<Object, Object> caffeineCacheBuilder() {
        return Caffeine.newBuilder()
                .expireAfterWrite(30, TimeUnit.MINUTES) // Set the expiration time for the tokens
                .maximumSize(100); // Set the maximum number of tokens to store in the cache
    }
}





package com.example.demo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cache.annotation.EnableCaching;

@SpringBootApplication
@EnableCaching

public class Demo1Application {

	public static void main(String[] args) {
		SpringApplication.run(Demo1Application.class, args);
	}

}







package com.example.demo;

import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Component;

@Component
public class TokenCache {
    @Cacheable(value = "tokens", key = "#jwtToken")
    public String getToken(String jwtToken) {
        // Retrieve the token from the data source or perform any necessary processing
        // This method will only be executed if the token is not already present in the cache
        return retrieveTokenFromDataSource(jwtToken);
    }

    private String retrieveTokenFromDataSource(String jwtToken) {
		return jwtToken;
        // Perform the actual token retrieval from the data source
        // Return the token
    }
}


.......................................................................................................................................................

package com.example.demo;

import com.github.benmanes.caffeine.cache.Caffeine;

import java.util.concurrent.TimeUnit;

import org.springframework.cache.CacheManager;
import org.springframework.cache.caffeine.CaffeineCacheManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;


@Configuration
public class CacheConfig {
	@Bean
	public CacheManager cacheManager() {
		CaffeineCacheManager cacheManager = new CaffeineCacheManager();
		cacheManager.setCaffeine(caffeineCacheBuilder());
		return cacheManager;
	}

	@Bean
	public Caffeine<Object, Object> caffeineCacheBuilder() {
		return Caffeine.newBuilder().expireAfterWrite(30, TimeUnit.MINUTES) // Set the expiration time for the tokens
				.maximumSize(100); // Set the maximum number of tokens to store in the cache
	}
}

//
//import com.google.common.cache.CacheBuilder;
//import org.springframework.cache.CacheManager;
//import org.springframework.cache.annotation.EnableCaching;
////import org.springframework.cache.guava.GuavaCacheManager;
//import org.springframework.cache.caffeine.CaffeineCacheManager;
//import org.springframework.cache.guava.GuavaCacheManager;
//
//import org.springframework.context.annotation.Bean;
//import org.springframework.context.annotation.Configuration;
//
//import java.util.concurrent.TimeUnit;
//
//@Configuration
//@EnableCaching
//public class CacheConfig {
//    @Bean
//    public CacheManager cacheManager() {
//        GuavaCacheManager cacheManager = new GuavaCacheManager();
//        cacheManager.setCacheBuilder(guavaCacheBuilder());
//        return cacheManager;
//    }
//
//    @Bean
//    public CacheBuilder<Object, Object> guavaCacheBuilder() {
//        return CacheBuilder.newBuilder()
//                .expireAfterWrite(30, TimeUnit.MINUTES) // Set the expiration time for the tokens
//                .maximumSize(100); // Set the maximum number of tokens to store in the cache
//    }
//}



















......


package com.example.demo;

import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Component;

import com.google.common.cache.CacheBuilder;
import com.google.common.cache.CacheLoader;
import com.google.common.cache.LoadingCache;

import java.util.concurrent.ExecutionException;
import java.util.concurrent.TimeUnit;

@Component
public class TokenCache {
  @Cacheable(value = "tokens", key = "#jwtToken")
    public String getToken(String jwtToken) {
        // Retrieve the token from the cache or data source
        String cachedToken = retrieveTokenFromCache(jwtToken);
        if (cachedToken != null) {
            return cachedToken; // Return the token from the cache
        }

        String tokenFromDataSource = retrieveTokenFromDataSource(jwtToken);
        cacheToken(jwtToken, tokenFromDataSource); // Cache the token for future use
        return tokenFromDataSource;
    }

    private String retrieveTokenFromCache(String jwtToken) {
		return jwtToken;
        // Retrieve the token from the cache if it exists
        // Return null if the token is not found in the cache
    }

    private String retrieveTokenFromDataSource(String jwtToken) {
		return jwtToken;
        // Perform the actual retrieval of the JWT token from the data source
        // This can involve querying a database, making an API call, or any other necessary logic
        // Return the retrieved token
    }

    private void cacheToken(String jwtToken, String token) {
        // Cache the token using the cache manager
    }
}

//@Component
//public class TokenCache {
//    @Cacheable(value = "tokens", key = "#jwtToken")
//    public String getToken(String jwtToken) {
//        // Retrieve the token from the data source or perform any necessary processing
//        // This method will only be executed if the token is not already present in the cache
//        return retrieveTokenFromDataSource(jwtToken);
//    }
//
//    private String retrieveTokenFromDataSource(String jwtToken) {
//		return jwtToken;
//        // Perform the actual token retrieval from the data source
//        // Return the token
//    }
//}
//

/*
 * In this example, the getToken method first checks if the token exists in the
 * cache. If it does, the cached token is returned. If the token is not found in
 * the cache, it calls the retrieveTokenFromDataSource method to retrieve the
 * token from the data source. Once the token is obtained, it is cached using
 * the cache manager before being returned.
 * 
 * The retrieveTokenFromDataSource method should contain the logic to retrieve
 * the token from your specific data source. This can include querying a
 * database, making an API call, or any other relevant operations. You will need
 * to implement this method according to your specific requirements and the
 * mechanism you use to store and retrieve the tokens.
 */

//private String retrieveTokenFromDataSource(String jwtToken) {
//    // Retrieve the token from the data source based on the jwtToken parameter
//    // You might query a database, make an API call, or perform any necessary operations to obtain the token
//    
//    String token = ... // Retrieve the token from the data source
//    
//    return token;
//}

//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.stereotype.Component;
//
//@Component
//public class TokenCache {
//    private final TokenRepository tokenRepository;
//
//    @Autowired
//    public TokenCache(TokenRepository tokenRepository) {
//        this.tokenRepository = tokenRepository;
//    }
//
//    @Cacheable(value = "tokens", key = "#jwtToken")
//    public String getToken(String jwtToken) {
//        return retrieveTokenFromDataSource(jwtToken);
//    }
//
//    private String retrieveTokenFromDataSource(String jwtToken) {
//        // Retrieve the token from the data source, such as a database
//        // You can use your own implementation or an ORM like Spring Data JPA
//
//        // Example: Assuming you have a TokenRepository to fetch the token from a database
//        Token token = tokenRepository.findByJwtToken(jwtToken);
//        return token != null ? token.getTokenValue() : null;
//    }
//}

........................................
111111111111

import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Component;

@Component
public class TokenCache {
    @Cacheable(value = "tokens", key = "#jwtToken")
    public String getToken(String jwtToken) {
        String cachedToken = retrieveTokenFromCache(jwtToken);
        if (cachedToken != null) {
            // Token is available in the cache
            System.out.println("Retrieved token from the cache: " + cachedToken);
            return cachedToken;
        }

        // Token not found in the cache, generate a new token
        String newToken = generateNewToken(jwtToken);
        System.out.println("Generated new token: " + newToken);

        // Store the new token in the cache
        cacheToken(jwtToken, newToken);

        return newToken;
    }

    private String retrieveTokenFromCache(String jwtToken) {
        // Retrieve the token from the cache implementation
        // Return null if the token is not found in the cache
        // Implement this based on your chosen cache implementation
        return null;
    }

    private String generateNewToken(String jwtToken) {
        // Perform the actual token generation logic
        // Implement this based on your requirements
        return "Generated Token";
    }

    private void cacheToken(String jwtToken, String token) {
        // Store the token in the cache implementation
        // Implement this based on your chosen cache implementation
    }
}
........

import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Component;

@Component
public class TokenCache {
    @Cacheable(value = "tokens", key = "#jwtToken")
    public String getToken(String jwtToken) {
        // This log statement is just for demonstration purposes
        System.out.println("Retrieving token from the cache or generating a new token...");

        // This block represents the actual retrieval logic
        String cachedToken = retrieveTokenFromCache(jwtToken);
        if (cachedToken != null) {
            // Token found in the cache, return it
            return cachedToken;
        } else {
            // Token not found in the cache, generate a new token
            String newToken = generateNewToken();
            cacheToken(jwtToken, newToken); // Store the new token in the cache
            return newToken;
        }
    }

    private String retrieveTokenFromCache(String jwtToken) {
        // Retrieve the token from the cache based on the provided jwtToken
        // Implement your cache retrieval logic here
        // If token is found, return it; otherwise, return null
        return null; // Placeholder for cache retrieval logic
    }

    private String generateNewToken() {
        // Generate a new token
        // Implement your token generation logic here
        return "Generated Token"; // Placeholder for token generation logic
    }

    private void cacheToken(String jwtToken, String token) {
        // Cache the token using the provided jwtToken as the cache key
        // Implement your cache storage logic here
    }
}
...............
import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Component;

@Component
public class TokenCache {
    @Cacheable(value = "tokens", key = "#jwtToken")
    public String getToken(String jwtToken) {
        // This log statement is just for demonstration purposes
        System.out.println("Retrieving token from the cache or generating a new token...");

        // Retrieve the token from the cache if it exists
        String cachedToken = getCachedToken(jwtToken);
        if (cachedToken != null) {
            System.out.println("Retrieved token from cache: " + cachedToken);
            return cachedToken;
        }

        // If the token is not present in the cache, generate a new token
        String newToken = generateToken();
        System.out.println("Generated new token: " + newToken);

        // Store the new token in the cache
        cacheToken(jwtToken, newToken);

        return newToken;
    }

    private String getCachedToken(String jwtToken) {
        // Retrieve the token from the cache based on the given jwtToken
        // Return null if the token is not present in the cache
        // Implement the cache retrieval logic here
        return null;
    }

    private String generateToken() {
        // Perform the actual token generation
        // Implement the token generation logic here
        return "Generated Token";
    }

    private void cacheToken(String jwtToken, String token) {
        // Store the token in the cache based on the given jwtToken
        // Implement the cache storage logic here
    }
}
